<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Virtual environments isolate a set of executables, libraries and related files from another such set. From the python docs:
 A virtual environment is a Python environment such that the Python interpreter, libraries and scripts installed into it are isolated from those installed in other virtual environments, and (by default) any libraries installed in a “system” Python, i."><meta property="og:title" content="Python virtual environments with pyenv"><meta property="og:description" content="Virtual environments isolate a set of executables, libraries and related files from another such set. From the python docs:
 A virtual environment is a Python environment such that the Python interpreter, libraries and scripts installed into it are isolated from those installed in other virtual environments, and (by default) any libraries installed in a “system” Python, i."><meta property="og:type" content="website"><meta property="og:image" content="https://amzon-ex.github.io/qprogblog/icon.png"><meta property="og:url" content="https://amzon-ex.github.io/qprogblog/notes/2022-03-26-pyenv-virtualenv/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="Python virtual environments with pyenv"><meta name=twitter:description content="Virtual environments isolate a set of executables, libraries and related files from another such set. From the python docs:
 A virtual environment is a Python environment such that the Python interpreter, libraries and scripts installed into it are isolated from those installed in other virtual environments, and (by default) any libraries installed in a “system” Python, i."><meta name=twitter:image content="https://amzon-ex.github.io/qprogblog/icon.png"><title>Python virtual environments with pyenv</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://amzon-ex.github.io/qprogblog//icon.png><link href=https://amzon-ex.github.io/qprogblog/styles.80333fa2099c0bee674efa435fde378c.min.css rel=stylesheet><link href=https://amzon-ex.github.io/qprogblog/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://amzon-ex.github.io/qprogblog/js/darkmode.4c8f1c4ba0f0d3915d7bdbf0800d57d5.min.js></script>
<script src=https://amzon-ex.github.io/qprogblog/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script defer src=https://amzon-ex.github.io/qprogblog/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://amzon-ex.github.io/qprogblog/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://amzon-ex.github.io/qprogblog/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://amzon-ex.github.io/qprogblog/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://amzon-ex.github.io/qprogblog/",fetchData=Promise.all([fetch("https://amzon-ex.github.io/qprogblog/indices/linkIndex.9a9f86ba2a443416af33010074e23c8d.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://amzon-ex.github.io/qprogblog/indices/contentIndex.76bffad8eaa092041abbf31e74c07e96.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://amzon-ex.github.io/qprogblog",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://amzon-ex.github.io/qprogblog",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/amzon-ex.github.io\/qprogblog\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=amzon-ex.github.io/qprogblog src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://amzon-ex.github.io/qprogblog/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://amzon-ex.github.io/qprogblog/>qProgblog</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Python virtual environments with pyenv</h1><p class=meta>Last updated
Mar 26, 2022</p><ul class=tags><li><a href=https://amzon-ex.github.io/qprogblog/tags/python/>Python</a></li><li><a href=https://amzon-ex.github.io/qprogblog/tags/pyenv/>Pyenv</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><ol><li><a href=#installation>Installation</a></li><li><a href=#usage>Usage</a></li><li><a href=#installing-ipython-kernel>Installing ipython kernel</a></li></ol></li></ol></nav></details></aside><p>Virtual environments isolate a set of executables, libraries and related files from another such set. From the <strong>python</strong>
<a href=https://docs.python.org/3/library/venv.html rel=noopener>docs</a>:</p><blockquote><p>A virtual environment is a Python environment such that the Python interpreter, libraries and scripts installed into it are isolated from those installed in other virtual environments, and (by default) any libraries installed in a “system” Python, i.e., one which is installed as part of your operating system.</p></blockquote><p>There are many options to do this: <strong>venv</strong> (comes installed by default with Python 3.3+), <strong>virtualenv</strong>, <strong>conda</strong>, <strong>poetry</strong> and so on&mldr; For people like us who use these languages mostly for scientific work, <strong>conda</strong> is a great option (and for other applications too - it handles dependency management well and has its own package manager <code>conda</code>), but it irks me to great measure because to install conda you&rsquo;d have to install a <strong>python</strong> version (the <em>base</em> version of conda) again (?!) and the install size, even for
<a href=https://docs.conda.io/en/latest/miniconda.html rel=noopener><strong>miniconda</strong></a>, is ~400MB. It is however a good option if that&rsquo;s the <em>first python installation one starts with</em> - I happened to have a working python installation (v3.9.7 on Ubuntu 21.10 on WSL) with many packages and I was unwilling to get rid of it and consequently break many applications.</p><p>Also, many applications demand a different python version altogether. If one does not use <strong>conda</strong>, separate python versions must be installed which can also break functionality if the path to the appropriate executable is not set in <code>PATH</code> and scripts do not properly select the right version. So this demands proper management. This is what we achieve with
<a href=https://github.com/pyenv/pyenv rel=noopener><strong>pyenv</strong></a>.</p><p><strong>pyenv</strong> helps manage various python installations on the system easily and also provides the plugin
<a href=https://github.com/pyenv/pyenv-virtualenv rel=noopener><strong>pyenv-virtualenv</strong></a> (installed separately, based on <strong>venv</strong>/<strong>virtualenv</strong>:
<a href=https://github.com/pyenv/pyenv-virtualenv#virtualenv-and-venv rel=noopener>more on this</a>).</p><a href=#installation><h3 id=installation><span class=hanchor arialabel=Anchor># </span>Installation</h3></a><p>To start with, we configure a
<a href=https://github.com/pyenv/pyenv/wiki#suggested-build-environment rel=noopener>proper build environment</a> for building Python distributions with <strong>pyenv</strong> on-the-fly:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get update<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo apt-get install make build-essential libssl-dev zlib1g-dev <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev
</span></span></code></pre></td></tr></table></div></div><p>Some of these packages would probably already be installed, but be prepared to install a bulk of packages. For me the download size was ~100MB and installation size ~500MB. <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><p>Once this is done, we install <strong>pyenv</strong> via a Github checkout (of course, <code>git</code> needs to be installed). To do so, we first clone the repo:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> git clone https://github.com/pyenv/pyenv.git ~/.pyenv
</span></span></code></pre></td></tr></table></div></div><p>where the location has been set as <em>~/.pyenv/</em>. This can be changed. Next, we optionally <em>try</em> to compile a <em>dynamic Bash extension</em> (without this step, <strong>pyenv</strong> works just fine, this should just speed up <strong>pyenv</strong>):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> <span class=nb>cd</span> ~/.pyenv <span class=o>&amp;&amp;</span> src/configure <span class=o>&amp;&amp;</span> make -C src
</span></span></code></pre></td></tr></table></div></div><p>Next, we configure the shell&rsquo;s environment to work with <strong>pyenv</strong>. For bash on Ubuntu with a <em>.profile</em> file that sources <em>.bashrc</em>,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sed -Ei -e <span class=s1>&#39;/^([^#]|$)/ {a \\ </span></span></span><span class=line><span class=cl><span class=s1>export PYENV_ROOT=&#34;$HOME/.pyenv&#34;
</span></span></span><span class=line><span class=cl><span class=s1>a \
</span></span></span><span class=line><span class=cl><span class=s1>export PATH=&#34;$PYENV_ROOT/bin:$PATH&#34;
</span></span></span><span class=line><span class=cl><span class=s1>a \
</span></span></span><span class=line><span class=cl><span class=s1>&#39;</span> -e <span class=s1>&#39;:a&#39;</span> -e <span class=s1>&#39;$!{n;ba};}&#39;</span> ~/.profile
</span></span></code></pre></td></tr></table></div></div><p>This puts the two <code>export</code> lines at the beginning (which is why we do all the gymnastics with <code>sed</code>) of <em>.profile</em> to</p><ul><li>Create the variable <em>$PYENV_ROOT</em> which stores the path to the folder we cloned the repo to, and</li><li>Add this variable to (the beginning of) <em>$PATH</em>.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;eval &#34;$(pyenv init --path)&#34;&#39;</span> &gt;&gt;~/.profile
</span></span></code></pre></td></tr></table></div></div><p>This puts the pyenv <em>shims</em> into <em>$PATH</em>. The <em>shims</em> redirect calls to the python executable to the right one. Details on the working
<a href=https://github.com/pyenv/pyenv#how-it-works rel=noopener>here</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;eval &#34;$(pyenv init -)&#34;&#39;</span> &gt;&gt; ~/.bashrc
</span></span></code></pre></td></tr></table></div></div><p>and this modifies <em>.bashrc</em>. For other setups, see
<a href=https://github.com/pyenv/pyenv#basic-github-checkout rel=noopener>here</a>.</p><p>Finally, we restart the shell - and we&rsquo;re done installing pyenv!</p><p>Next, we install <strong>pyenv-virtualenv</strong>. This simply requires checking out the repo to the <em>.pyenv/plugins/</em> directory:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/pyenv/pyenv-virtualenv.git <span class=k>$(</span>pyenv root<span class=k>)</span>/plugins/pyenv-virtualenv
</span></span></code></pre></td></tr></table></div></div><p>and we then run</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>exec</span> &lt;shell&gt;
</span></span></code></pre></td></tr></table></div></div><p>(in our case, <code>&lt;shell></code> is just <code>bash</code>) to restart the shell.</p><p>If installed with this method, upgrading is super simple - we just go the <em>.pyenv</em> directory and pull from the repo.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> <span class=k>$(</span>pyenv root<span class=k>)</span>
</span></span><span class=line><span class=cl>git pull
</span></span></code></pre></td></tr></table></div></div><p>and a similar procedure follows for <strong>pyenv-virtualenv</strong>.</p><a href=#usage><h3 id=usage><span class=hanchor arialabel=Anchor># </span>Usage</h3></a><p>When using <strong>pyenv</strong>, we have a <em>system</em> version of python that is present by default (python was installed by default, of course). We can install more versions by running</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pyenv install &lt;version&gt;
</span></span></code></pre></td></tr></table></div></div><p>where we <code>&lt;version></code> may be replaced by <code>3.8.1</code>, for instance. We can list all available versions by typing</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pyenv install --list
</span></span></code></pre></td></tr></table></div></div><p>and choose the appropriate one. After installation, this goes under <em>.pyenv/versions/{version}/</em> and all packages/virtual-environments concerning this version go under this directory. We can list the currently installed versions by</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pyenv versions
</span></span></code></pre></td></tr></table></div></div><p>The currently active version is marked by an asterisk (*). This can also be checked by running <code>pyenv version</code> instead. The output of the command will depend upon the current session or the current location. This is how <strong>pyenv</strong> chooses the python version (from the docs):</p><blockquote><ol><li><p>The <em>PYENV_VERSION</em> environment variable (if specified). You can use the <code>pyenv shell</code> command to set this environment variable in your current shell session.</p></li><li><p>The application-specific <em>.python-version</em> file in the current directory (if present). You can modify the current directory&rsquo;s <em>.python-version</em> file with the <code>pyenv local</code> command.</p></li><li><p>The first <em>.python-version</em> file found (if any) by searching each parent directory, until reaching the root of your filesystem.</p></li><li><p>The global <em>$(pyenv root)/version</em> file. You can modify this file using the <code>pyenv global</code> command. If the global version file is not present, pyenv assumes you want to use the <em>system</em> Python. (In other words, whatever version would run if pyenv weren&rsquo;t in your <em>PATH</em>.)</p></li></ol></blockquote><p>In other words, there are two ways to specify a python version to use:</p><ul><li>Change the version being used for the current session by running <code>pyenv shell &lt;version></code>. Running <code>pyenv shell</code> or <code>pyenv version</code> would now show <code>&lt;version></code> as output. For this session, until changed, this version will be used for running python scripts. We can run <code>pyenv shell --unset</code> to revert to the shell being originally used before any such commands were executed. <em>This choice has the higest precedence.</em></li><li>Create a <em>.python-version</em> file by running <code>pyenv local &lt;version></code> in a project directory. Whenever scripts are run from this directory, or <em>any</em> subdirectories, the chosen version will always be used, considering no shell version has been configured for the session. One can set multiple versions in decreasing order of precedence by running <code>pyenv local &lt;version-1> &lt;version-2> ...</code> in a directory. Again, running <code>pyenv local</code> or <code>pyenv version</code> would now show the active versions as output. To unset this file/config, run <code>pyenv local --unset</code>.</li></ul><p>To uninstall a python version, we can either run <code>pyenv uninstall &lt;version></code> or remove the entire <em>{version}/</em> directory in <em>.pyenv/versions/</em>.</p><p>To create virtual environments (our original concern!), we run the command</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pyenv virtualenv &lt;version&gt; &lt;env-name&gt;
</span></span></code></pre></td></tr></table></div></div><p>i.e. we select a <code>&lt;version></code> and specify the name <code>&lt;env-name></code> of the virtual environment we want to create. We can omit <code>&lt;version></code>: in that case, the version currently set will be used to create the virtual environment, as determined by our configuration. The packages installed under this environment will be listed under the directory <em>.pyenv/versions/{version}/envs/{env-name}</em>. To activate this environment, we run</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pyenv activate &lt;env-name&gt;
</span></span></code></pre></td></tr></table></div></div><p>and <code>pyenv deactivate</code> to - well, deactivate the environment. To list created virtual environments, we run <code>pyenv virtualenvs</code>. It is possible to specify a virtual environment in a local <em>.python-version</em> file by running</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pyenv <span class=nb>local</span> &lt;env-name&gt;
</span></span></code></pre></td></tr></table></div></div><p>As mentioned before, we can list multiple python versions, environments etc. separated by spaces.</p><p>To remove an environment altogether, we can run</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pyenv virtualenv-delete &lt;env-name&gt;
</span></span></code></pre></td></tr></table></div></div><p>or just delete the <em>{env-name}</em> directory in <em>.pyenv/versions/{version}/envs/</em>.</p><p>After activating, we might want to install necessary packages. One could do this using a <em>requirements</em> text file which lists specific versions of packages (perhaps a natural use-case in virtual environments), passed to <code>pip</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install -r requirements.txt
</span></span></code></pre></td></tr></table></div></div><p>It could be helpful to use a <code>--no-cache-dir</code> option if <code>pip</code> uses cached versions which do not match the required version.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><a href=#installing-ipython-kernel><h3 id=installing-ipython-kernel><span class=hanchor arialabel=Anchor># </span>Installing ipython kernel</h3></a><p>Finally, we could install an <strong>ipython kernel</strong> for a virtual environment, if we use <strong>jupyter notebook</strong> installed for the <em>system</em> version. Installing multiple jupyter instances may in general not make sense (?). So we run</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pyenv activate &lt;env-name&gt;
</span></span><span class=line><span class=cl>pip install ipykernel ipython_genutils
</span></span></code></pre></td></tr></table></div></div><p><strong>Note:</strong> Depending upon the project and/or the python version, a specific version of ipykernel might be required. By installing <strong>ipython_genutils</strong> for the environment we can get away without installing <strong>ipython</strong> itself, since it will be installed for the <em>system</em> version.</p><p>After the installation, we may run</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python -m ipykernel install --user --name<span class=o>=</span>&lt;env-kernel-name&gt;
</span></span></code></pre></td></tr></table></div></div><p>where we type in a name for this kernel. It need not be identical to <code>&lt;env-name></code>. Now when we fire Jupyter Lab/notebook, this kernel should be available. We wouldn&rsquo;t need to activate the virtual environment for this purpose.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Of course, one can ask here if this defeats the purpose of <em>not</em> installing <strong>conda</strong> - but it is probably not necessary to install all of these. It is <em>suggested</em> by the devs - the question of potential failure would probably need to be answered on a case-by-case basis. In any case, this step can probably be optimized. <em>TO BE INVESTIGATED</em>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>This may likely happen when the unlisted dependencies of the packages listed are installed from cache. However, using <code>--no-cache-dir</code> might significantly increase install times. Some details
<a href=https://stackoverflow.com/questions/9510474/pip-uses-incorrect-cached-package-version-instead-of-the-user-specified-version/61762308#61762308 rel=noopener>here</a>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://amzon-ex.github.io/qprogblog/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by Ayon Tarafdar using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2023</p><ul><li><a href=https://amzon-ex.github.io/qprogblog/>Home</a></li><li><a href=https://github.com/amzon-ex>GitHub</a></li></ul></footer></div></div></body></html>